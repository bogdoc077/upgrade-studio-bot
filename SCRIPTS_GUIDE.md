# –°–∫—Ä–∏–ø—Ç–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å–∞–º–∏

–ù–∞–±—ñ—Ä bash —Å–∫—Ä–∏–ø—Ç—ñ–≤ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≤—Å—ñ–º–∞ —Å–µ—Ä–≤—ñ—Å–∞–º–∏ –ø—Ä–æ–µ–∫—Ç—É.

## üöÄ –î–æ—Å—Ç—É–ø–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏

### `./start_all.sh`
–ó–∞–ø—É—Å–∫–∞—î –≤—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –ø—Ä–æ–µ–∫—Ç—É –≤ —Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ.

**–©–æ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è:**
- API Server (–ø–æ—Ä—Ç 8001) - FastAPI –¥–ª—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ
- Webhook Server (–ø–æ—Ä—Ç 8000) - –æ–±—Ä–æ–±–∫–∞ Telegram —Ç–∞ Stripe webhooks
- Admin Panel (–ø–æ—Ä—Ç 3000) - Next.js —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```bash
./start_all.sh
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** Telegram Bot –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ webhooks (—ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ –≤ Webhook Server), polling —Ä–µ–∂–∏–º (main.py) –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è.

---

### `./stop_all.sh`
–ó—É–ø–∏–Ω—è—î –≤—Å—ñ –∑–∞–ø—É—â–µ–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏.

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```bash
./stop_all.sh
```

**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ó—É–ø–∏–Ω—è—î –ø—Ä–æ—Ü–µ—Å–∏ –∑–∞ PID —Ñ–∞–π–ª–∞–º–∏
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –∑–∞–ª–∏—à–∫–æ–≤—ñ –ø—Ä–æ—Ü–µ—Å–∏
- –ó–≤—ñ–ª—å–Ω—è—î –ø–æ—Ä—Ç–∏ 8000, 8001, 3000
- –ü–æ–ø–µ—Ä–µ–¥–∂–∞—î —è–∫—â–æ –∑–Ω–∞–π–¥–µ–Ω–æ main.py (polling —Ä–µ–∂–∏–º)

---

### `./restart_all.sh`
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î –≤—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ (stop ‚Üí pause ‚Üí start).

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```bash
./restart_all.sh
```

---

### `./status.sh`
–ü–æ–∫–∞–∑—É—î –¥–µ—Ç–∞–ª—å–Ω–∏–π —Å—Ç–∞—Ç—É—Å –≤—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤.

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```bash
./status.sh
```

**–©–æ –ø–æ–∫–∞–∑—É—î:**
- –°—Ç–∞—Ç—É—Å –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É (PID, CPU, RAM)
- –°—Ç–∞–Ω –ø–æ—Ä—Ç—ñ–≤
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ —Å–∏—Å—Ç–µ–º–∏
- –û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –≤ –ª–æ–≥–∞—Ö
- –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ (polling vs webhooks)

---

## üìÅ –§–∞–π–ª–∏ —Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó

### PID —Ñ–∞–π–ª–∏
–°—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤—ñ—Å—ñ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å–∞–º–∏:
- `.pids_api` - API Server
- `.pids_webhook` - Webhook Server
- `.pids_admin_panel` - Admin Panel

### –õ–æ–≥–∏
–í—Å—ñ –ª–æ–≥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `./logs/`:
- `api.log` - API Server
- `webhook.log` - Webhook Server (Telegram + Stripe)
- `admin_panel.log` - Next.js Admin Panel

---

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –í–∏–º–æ–≥–∏
- Python 3.12+ –∑ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–º–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏
- Node.js 18+ –¥–ª—è Admin Panel
- Virtual environment –≤ `./venv/`

### –ü–µ—Ä—à–∏–π –∑–∞–ø—É—Å–∫
```bash
# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ Python
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ Node.js
cd admin-panel
npm install
cd ..

# –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ .env —Ñ–∞–π–ª
cp .env.example .env
# –í—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ .env –∑ –≤–∞—à–∏–º–∏ –∫–ª—é—á–∞–º–∏

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—Å–µ
./start_all.sh
```

---

## ‚öôÔ∏è Production deployment

**–î–ª—è production –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ systemd**, –∞ –Ω–µ —Ü—ñ —Å–∫—Ä–∏–ø—Ç–∏!

Systemd —Å–µ—Ä–≤—ñ—Å–∏ (–Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ):
```bash
# –ó–∞–ø—É—Å–∫
sudo systemctl start upgrade-api upgrade-webhook

# –°—Ç–∞—Ç—É—Å
sudo systemctl status upgrade-api upgrade-webhook

# –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ boot
sudo systemctl enable upgrade-api upgrade-webhook

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart upgrade-api upgrade-webhook
```

---

## üêõ Troubleshooting

### –ü–æ—Ä—Ç–∏ –∑–∞–π–Ω—è—Ç—ñ
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ö—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø–æ—Ä—Ç
lsof -ti:8000

# –ó–≤—ñ–ª—å–Ω–∏—Ç–∏ –ø–æ—Ä—Ç
lsof -ti:8000 | xargs kill -9
```

### –ü—Ä–æ—Ü–µ—Å–∏ –Ω–µ –∑—É–ø–∏–Ω—è—é—Ç—å—Å—è
```bash
# –ó–Ω–∞–π—Ç–∏ –≤—Å—ñ Python –ø—Ä–æ—Ü–µ—Å–∏ –ø—Ä–æ–µ–∫—Ç—É
ps aux | grep -E "start_api|webhook_server|main.py"

# –ó—É–ø–∏–Ω–∏—Ç–∏ –≤—Ä—É—á–Ω—É
kill -9 <PID>
```

### –ö–æ–Ω—Ñ–ª—ñ–∫—Ç polling/webhooks
–Ø–∫—â–æ –±–∞—á–∏—Ç–µ –ø–æ–º–∏–ª–∫—É "terminated by other getUpdates request":
```bash
# –ó–Ω–∞–π—Ç–∏ main.py –ø—Ä–æ—Ü–µ—Å
ps aux | grep main.py | grep -v grep

# –ó—É–ø–∏–Ω–∏—Ç–∏ polling
ps aux | grep main.py | grep -v grep | awk '{print $2}' | xargs kill -9

# –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—å —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ webhook
./status.sh
```

### –õ–æ–≥–∏ –ø–æ–∫–∞–∑—É—é—Ç—å –ø–æ–º–∏–ª–∫–∏
```bash
# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
tail -f logs/webhook.log
tail -f logs/api.log

# –ü–æ—à—É–∫ –ø–æ–º–∏–ª–æ–∫
grep -i error logs/*.log
```

---

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –®–≤–∏–¥–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
```bash
./status.sh
```

### –î–µ—Ç–∞–ª—å–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
```bash
# CPU —Ç–∞ RAM
top

# –ú–µ—Ä–µ–∂–∞
netstat -tulpn | grep -E "8000|8001|3000"

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
tail -f logs/*.log
```

---

## üîÑ –¢–∏–ø–æ–≤—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó

### –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—Å–µ
./start_all.sh

# –ü–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ –ª–æ–≥–∏
tail -f logs/webhook.log

# –ü—Ä–∏ –∑–º—ñ–Ω—ñ –∫–æ–¥—É - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏
./restart_all.sh
```

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è
```bash
# –ó—É–ø–∏–Ω–∏—Ç–∏ –≤—Å–µ
./stop_all.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω–µ
python start_api.py  # –¢—ñ–ª—å–∫–∏ API
python webhook_server.py  # –¢—ñ–ª—å–∫–∏ webhooks
```

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É
```bash
# –ó—É–ø–∏–Ω–∏—Ç–∏
./stop_all.sh

# –û–Ω–æ–≤–∏—Ç–∏ –∑ git
git pull

# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –Ω–æ–≤—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
pip install -r requirements.txt
cd admin-panel && npm install && cd ..

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏
./start_all.sh
```

---

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

1. **–ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ polling (main.py) –æ–¥–Ω–æ—á–∞—Å–Ω–æ –∑ webhooks** - —Ü–µ —Å—Ç–≤–æ—Ä—é—î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏
2. **–î–ª—è production –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ systemd**, –∞ –Ω–µ —Ü—ñ —Å–∫—Ä–∏–ø—Ç–∏
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –ª–æ–≥–∏** –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫
4. **WEBHOOK_URL –º–∞—î –±—É—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π** –≤ .env –¥–ª—è —Ä–æ–±–æ—Ç–∏ Telegram –±–æ—Ç–∞

---

## üìö –î–æ–¥–∞—Ç–∫–æ–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- [TELEGRAM_WEBHOOK_SETUP.md](TELEGRAM_WEBHOOK_SETUP.md) - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Telegram webhooks
- [EVENT_DRIVEN_ARCHITECTURE.md](EVENT_DRIVEN_ARCHITECTURE.md) - Event-driven –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
- [RAM_OPTIMIZATION.md](RAM_OPTIMIZATION.md) - –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø–∞–º'—è—Ç—ñ
- [DEPLOYMENT_CHECKLIST.md](deployment/DEPLOYMENT_CHECKLIST.md) - Production deployment
