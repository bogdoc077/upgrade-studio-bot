# üîê –ö—Ä–∏—Ç–∏—á–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏

–î–∞—Ç–∞: 17 —Å—ñ—á–Ω—è 2026

## ‚ö†Ô∏è –í–∏—è–≤–ª–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏

### 1. Path Traversal –≤ API (CRITICAL - –í–ò–ü–†–ê–í–õ–ï–ù–û)

**–§–∞–π–ª:** `api/server.py`, —Ñ—É–Ω–∫—Ü—ñ—è `delete_broadcast_file()`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
filename = file_url.split('/')[-1]
file_path = BROADCASTS_DIR / filename
os.remove(file_path)
```

API endpoint –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è–≤ —á–∏ `filename` –º—ñ—Å—Ç–∏—Ç—å path traversal —Å–∏–º–≤–æ–ª–∏ (`..`, `/`). –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º—ñ–≥ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏:
```
DELETE /api/broadcasts/file?file_url=/uploads/broadcasts/../../../bin/bash
```

–¶–µ –ø—Ä–∏–∑–≤–µ–ª–æ –¥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤, –≤–∫–ª—é—á–Ω–æ –∑ `/bin/*`, —â–æ –∑—Ä–æ–±–∏–ª–æ —Å–µ—Ä–≤–µ—Ä –Ω–µ–ø—Ä–∞—Ü–µ–∑–¥–∞—Ç–Ω–∏–º.

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è (–∫–æ–º—ñ—Ç `502971b`):**
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å `..`, `/`, `\` —É filename
- ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è —â–æ resolved path –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –º–µ–∂–∞—Ö `BROADCASTS_DIR`
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —â–æ —Ü–µ —Ñ–∞–π–ª, –∞ –Ω–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è
- ‚úÖ –î–æ–¥–∞–Ω–æ try-catch –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫

### 2. –ù–µ–±–µ–∑–ø–µ—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Firewall (CRITICAL - –í–ò–ü–†–ê–í–õ–ï–ù–û)

**–§–∞–π–ª:** `deployment/fresh_install.sh`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```bash
ufw default deny incoming  # –ë–ª–æ–∫—É—î –í–°–ï, –≤–∫–ª—é—á–Ω–æ –∑ SSH!
ufw default allow outgoing
ufw allow 22/tcp    # –ü–æ—Ç—ñ–º –¥–æ–∑–≤–æ–ª—è—î SSH
ufw --force enable  # –Ø–∫—â–æ allow 22 –Ω–µ –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è - SSH –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π!
```

–Ø–∫—â–æ –∫–æ–º–∞–Ω–¥–∞ `ufw allow 22/tcp` –Ω–µ –≤–∏–∫–æ–Ω–∞–ª–∞—Å—è (–ø–æ–º–∏–ª–∫–∞, –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω–Ω—è, –∑–±—ñ–π), —Ç–æ–¥—ñ SSH –±–ª–æ–∫—É—î—Ç—å—Å—è —ñ —Å–µ—Ä–≤–µ—Ä —Å—Ç–∞—î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–º –Ω–∞–∑–∞–≤–∂–¥–∏.

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è (—Å—Ç–≤–æ—Ä–µ–Ω–æ `safe_deploy.sh`):**
```bash
# –ü–†–ê–í–ò–õ–¨–ù–ò–ô –ø–æ—Ä—è–¥–æ–∫:
ufw allow 22/tcp     # 1. –°–ø–æ—á–∞—Ç–∫—É –¥–æ–∑–≤–æ–ª—è—î–º–æ SSH
ufw allow 80/tcp
ufw allow 443/tcp
ufw default deny incoming  # 2. –¢—ñ–ª—å–∫–∏ —Ç–µ–ø–µ—Ä –±–ª–æ–∫—É—î–º–æ —ñ–Ω—à—ñ
ufw default allow outgoing
ufw --force enable

# 3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —â–æ SSH –¥–æ–∑–≤–æ–ª–µ–Ω–æ
if ! ufw status | grep -q "22/tcp.*ALLOW"; then
    echo "–ü–û–ú–ò–õ–ö–ê: SSH –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π!"
    ufw disable  # –í—ñ–¥–∫–ª—é—á–∞—î–º–æ firewall –¥–ª—è –±–µ–∑–ø–µ–∫–∏
    exit 1
fi
```

### 3. –ú–æ–∂–ª–∏–≤–∏–π –±–µ–∫–¥–æ—Ä (–ü–ï–†–ï–í–Ü–†–ï–ù–û - –ù–ï –ó–ù–ê–ô–î–ï–ù–û)

**–ü–æ—à—É–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ:**
- ‚ùå `eval()`, `exec()`, `__import__` –≤ Python - –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
- ‚ùå `base64.b64decode` –∑ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º –∫–æ–¥—É - –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
- ‚ùå –ü—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏ –∑ –ø—ñ–¥–æ–∑—Ä—ñ–ª–∏–º –∫–æ–¥–æ–º - –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
- ‚ö†Ô∏è `curl | bash` –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Node.js - –ª–µ–≥—ñ—Ç–∏–º–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

**–í–∏—Å–Ω–æ–≤–æ–∫:** –ë–µ–∫–¥–æ—Ä—É –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ. –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ö–æ—Å—Ç–∏–Ω–≥—É –º–æ–≥–ª–∞ –ø–æ–º–∏–ª–∏—Ç–∏—Å—è –∞–±–æ –≤–∏—è–≤–∏–ª–∞ —Å—Ç–∞—Ä–∏–π –∫–æ–¥ –¥–æ –Ω–∞—à–∏—Ö –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å.

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### –î–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è:

1. **–û–ë–û–í'–Ø–ó–ö–û–í–û:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –Ω–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç `deployment/safe_deploy.sh`
2. **–ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ:** `deployment/fresh_install.sh` (–Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π firewall)
3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:** –©–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –æ—Å—Ç–∞–Ω–Ω—ñ –∫–æ–º—ñ—Ç–∏ –∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º–∏:
   - `502971b` - Path traversal fix
   - `f809020` - Safe deployment script

### –ü—ñ—Å–ª—è –ø–µ—Ä–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –û–°:

```bash
# 1. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞
ssh root@173.242.49.209

# 2. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –±–µ–∑–ø–µ—á–Ω–∏–π —Å–∫—Ä–∏–ø—Ç
cd /tmp
wget https://raw.githubusercontent.com/bogdoc077/upgrade-studio-bot/main/deployment/safe_deploy.sh
chmod +x safe_deploy.sh

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ (–≤—ñ–Ω —Å–∞–º –∫–ª–æ–Ω—É—î —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º–∏)
./safe_deploy.sh

# 4. –°—Ç–≤–æ—Ä–∏—Ç–∏ .env —Ñ–∞–π–ª
nano /opt/upgrade-studio-bot/.env

# 5. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ SSL
certbot --nginx -d admin.upgrade21.com --non-interactive --agree-tos --email admin@upgrade21.com --redirect

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å–∏
systemctl enable upgrade-api upgrade-webhook upgrade-admin
systemctl start upgrade-api upgrade-webhook upgrade-admin

# 7. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
systemctl status upgrade-api upgrade-webhook upgrade-admin
```

### –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–∞—Ö–æ–¥–∏ –±–µ–∑–ø–µ–∫–∏:

1. **–ó–º—ñ–Ω–∏—Ç–∏ SSH –ø–æ—Ä—Ç** –∑ 22 –Ω–∞ —ñ–Ω—à–∏–π (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 2222)
2. **–ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ root login** —á–µ—Ä–µ–∑ SSH
3. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ SSH –∫–ª—é—á—ñ** –∑–∞–º—ñ—Å—Ç—å –ø–∞—Ä–æ–ª—ñ–≤
4. **–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ fail2ban** –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ brute-force
5. **–û–±–º–µ–∂–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ API** —Ç—ñ–ª—å–∫–∏ –∑ –ø–µ–≤–Ω–∏—Ö IP
6. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏** —Å–∏—Å—Ç–µ–º—É —Ç–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

## üîç –Ø–∫ —Ü–µ —Å—Ç–∞–ª–æ—Å—è?

1. –í API –±—É–≤ path traversal –≤ `delete_broadcast_file()`
2. –•—Ç–æ—Å—å (–∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∞–±–æ –≤–∏–ø–∞–¥–∫–æ–≤–∞ –ø–æ–º–∏–ª–∫–∞) –Ω–∞–¥—ñ—Å–ª–∞–≤ –∑–∞–ø–∏—Ç –Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—É –∑ path traversal
3. –ö–æ–¥ –≤–∏–¥–∞–ª–∏–≤ —Å–∏—Å—Ç–µ–º–Ω—ñ —Ñ–∞–π–ª–∏ –≤ `/bin/`
4. –°–µ—Ä–≤–µ—Ä —Å—Ç–∞–≤ –Ω–µ–ø—Ä–∞—Ü–µ–∑–¥–∞—Ç–Ω–∏–º
5. –ü—Ä–∏ —Å–ø—Ä–æ–±—ñ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è - firewall –∑–∞–±–ª–æ–∫—É–≤–∞–≤ SSH (—á–µ—Ä–µ–∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –∫–æ–º–∞–Ω–¥ —É —Å–∫—Ä–∏–ø—Ç—ñ)

## ‚úÖ –°—Ç–∞—Ç—É—Å –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å

- ‚úÖ **Path Traversal** - –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —É –∫–æ–º—ñ—Ç—ñ `502971b`
- ‚úÖ **Firewall –±–ª–æ–∫—É–≤–∞–Ω–Ω—è SSH** - –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —É `safe_deploy.sh` (–∫–æ–º—ñ—Ç `f809020`)
- ‚úÖ **–ö–æ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ** –Ω–∞ –±–µ–∫–¥–æ—Ä–∏ - –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
- ‚è≥ **–ü–æ—Ç—Ä—ñ–±–Ω–∞ –ø–µ—Ä–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –û–°** –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ

## üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–Ω—É—Ç—å –ø–∏—Ç–∞–Ω–Ω—è, –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ –∞–±–æ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:
- Git history: `git log --oneline`
- Server logs: `/opt/upgrade-studio-bot/logs/`
- Systemd logs: `journalctl -u upgrade-*`
