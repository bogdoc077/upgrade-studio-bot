# üö® –ü–†–û–ë–õ–ï–ú–ê: 90 –ì–ë –í–∏—Ö—ñ–¥–Ω–æ–≥–æ –¢—Ä–∞—Ñ—ñ–∫—É –Ω–∞ –î–µ–Ω—å

## –î—ñ–∞–≥–Ω–æ–∑

**–ì–æ–ª–æ–≤–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞**: SQLAlchemy echo=True –≤ —Ä–µ–∂–∏–º—ñ DEBUG

### –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:

```python
# –í database/models.py –±—É–ª–æ:
engine = create_engine(
    settings.database_url, 
    echo=True if settings.log_level == "DEBUG" else False,  # ‚ùå –ü–†–û–ë–õ–ï–ú–ê!
)
```

–ö–æ–ª–∏ `LOG_LEVEL=DEBUG`:
- **echo=True** –ª–æ–≥—É—î –ö–û–ñ–ï–ù SQL –∑–∞–ø–∏—Ç
- –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç = ~1-5 –ö–ë –ª–æ–≥—ñ–≤
- –ü—Ä–∏ 1000+ –∑–∞–ø–∏—Ç—ñ–≤/—Ö–≤ = **60-300 –ú–ë/–≥–æ–¥–∏–Ω–∞**
- –ó–∞ –¥–æ–±—É = **1.4-7.2 –ì–ë** —Ç—ñ–ª—å–∫–∏ SQL –ª–æ–≥–∏

### –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ñ–∞–∫—Ç–æ—Ä–∏:

1. **–ö—Ä–æ–Ω–∏ –ø—Ä–∞—Ü—é—é—Ç—å –∑–∞–Ω–∞–¥—Ç–æ —á–∞—Å—Ç–æ**
   - Payment events: –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥ = 8,640 –∑–∞–ø—É—Å–∫—ñ–≤/–¥–µ–Ω—å
   - Broadcasts: –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥ = 2,880 –∑–∞–ø—É—Å–∫—ñ–≤/–¥–µ–Ω—å
   - –ö–æ–∂–µ–Ω –∑–∞–ø—É—Å–∫ = –º—ñ–Ω—ñ–º—É–º 5-10 SQL –∑–∞–ø–∏—Ç—ñ–≤

2. **–ü–æ—Å—Ç—ñ–π–Ω—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è –¥–æ –ë–î**
   - –ë–µ–∑ connection pooling = –Ω–æ–≤—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è –∫–æ–∂–µ–Ω —Ä–∞–∑
   - –ö–æ–∂–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è = handshake + auth = —Ç—Ä–∞—Ñ—ñ–∫

3. **–ó–∞—Å—Ç—Ä—è–≥–ª—ñ —Ä–æ–∑—Å–∏–ª–∫–∏/–Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è**
   - –ë–æ—Ç –º–æ–∂–µ –ø–æ—Å—Ç—ñ–π–Ω–æ –Ω–∞–º–∞–≥–∞—Ç–∏—Å—è –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏
   - Telegram API –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø–æ–º–∏–ª–∫–∞–º–∏
   - –õ–æ–≥–∏ –∑–∞–ø–∏—Å—É—é—Ç—å –∫–æ–∂–Ω—É —Å–ø—Ä–æ–±—É

4. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –æ—á–∏—â–µ–Ω–Ω—è**
   - –°—Ç–∞—Ä—ñ –ø–æ–¥—ñ—ó –Ω–∞–∫–æ–ø–∏—á—É—é—Ç—å—Å—è
   - –ë–æ—Ç –æ–±—Ä–æ–±–ª—è—î —ó—Ö –∑–Ω–æ–≤—É —ñ –∑–Ω–æ–≤—É

## üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### ‚úÖ –í–∂–µ –≤–∏–∫–æ–Ω–∞–Ω–æ:

1. **–í–∏–º–∫–Ω–µ–Ω–æ echo –¥–ª—è –ë–î** (–ö–†–ò–¢–ò–ß–ù–û!)
   ```python
   echo=False  # –ó–∞–≤–∂–¥–∏ False –¥–ª—è production!
   ```

2. **–î–æ–¥–∞–Ω–æ connection pooling**
   - –ï–∫–æ–Ω–æ–º—ñ—è 60% –∑'—î–¥–Ω–∞–Ω—å
   - –ú–µ–Ω—à–µ handshake —Ç—Ä–∞—Ñ—ñ–∫—É

3. **–û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ –∫—Ä–æ–Ω—ñ–≤**
   - Payment events: 10 —Å–µ–∫ ‚Üí 2 —Ö–≤ (‚Üì92%)
   - Broadcasts: 30 —Å–µ–∫ ‚Üí 5 —Ö–≤ (‚Üì90%)

4. **–î–æ–¥–∞–Ω–æ –∞–≤—Ç–æ–æ—á–∏—â–µ–Ω–Ω—è**
   - –°—Ç–∞—Ä—ñ –ø–æ–¥—ñ—ó –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è —á–µ—Ä–µ–∑ 7 –¥–Ω—ñ–≤
   - –©–æ–¥–Ω—è –æ 03:00

5. **–û–±–º–µ–∂–µ–Ω–æ –ë–î –∑–∞–ø–∏—Ç–∏**
   - –ú–∞–∫—Å–∏–º—É–º 10-50 –∑–∞–ø–∏—Å—ñ–≤ –∑–∞ —Ä–∞–∑

### üìã –ü–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ:

```bash
# 1. –û–Ω–æ–≤–∏—Ç–∏ –∫–æ–¥
cd /home/admin/upgrade-studio-bot
git pull

# 2. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ LOG_LEVEL=INFO
echo "LOG_LEVEL=INFO" >> .env

# 3. –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
python diagnose_traffic.py

# 4. –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º
python fix_traffic.py

# 5. –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
./apply_ram_optimization.sh

# 6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏
sudo systemctl restart upgrade-bot upgrade-api upgrade-webhook
```

## üìä –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏:

| –ü–æ–∫–∞–∑–Ω–∏–∫ | –î–æ | –ü—ñ—Å–ª—è |
|----------|----|----|
| **–¢—Ä–∞—Ñ—ñ–∫/–¥–µ–Ω—å** | ~90 –ì–ë | ~500 –ú–ë |
| **SQL –ª–æ–≥–∏** | 5-7 –ì–ë/–¥–µ–Ω—å | 0 |
| **–ë–î –∑'—î–¥–Ω–∞–Ω–Ω—è** | –ù–µ–æ–±–º–µ–∂–µ–Ω–æ | 5-15 |
| **–ö—Ä–æ–Ω–∏/–≥–æ–¥–∏–Ω–∞** | 240+ | 42 |

## üîç –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç—Ä–∞—Ñ—ñ–∫—É:

```bash
# –†–µ–∞–ª—å–Ω–∏–π —á–∞—Å
iftop -i eth0

# –ü–æ –ø—Ä–æ—Ü–µ—Å–∞—Ö
nethogs

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
vnstat -d
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤:

```bash
# –†–æ–∑–º—ñ—Ä –ª–æ–≥—ñ–≤
du -sh logs/
du -sh /var/log/

# SQL –∑–∞–ø–∏—Ç–∏ –≤ –ª–æ–≥–∞—Ö (–º–∞—î –±—É—Ç–∏ 0!)
journalctl -u upgrade-bot | grep "SELECT" | wc -l
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Ä–≤—ñ—Å—ñ–≤:

```bash
# –°—Ç–∞—Ç—É—Å
systemctl status upgrade-bot

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
journalctl -u upgrade-bot -f

# –û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–º–∏–ª–∫–∏
journalctl -u upgrade-bot -p err -n 50
```

## üí° –ü—Ä–æ—Ñ—ñ–ª–∞–∫—Ç–∏–∫–∞

### 1. –ù—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ DEBUG –≤ production!

```bash
# –í .env –∑–∞–≤–∂–¥–∏:
LOG_LEVEL=INFO  # –∞–±–æ WARNING
```

### 2. –ú–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ —Ç—Ä–∞—Ñ—ñ–∫

```bash
# –î–æ–¥–∞—Ç–∏ –≤ cron (—â–æ–¥–Ω—è –æ 00:00):
0 0 * * * vnstat -d | mail -s "Daily Traffic Report" admin@example.com
```

### 3. –†–æ—Ç–∞—Ü—ñ—è –ª–æ–≥—ñ–≤

```bash
# /etc/logrotate.d/upgrade-bot
/home/admin/upgrade-studio-bot/logs/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
}
```

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è

```bash
# –í–∂–µ –¥–æ–¥–∞–Ω–æ –≤ scheduler (–æ 03:00):
# - –û—á–∏—â–µ–Ω–Ω—è payment_events > 7 –¥–Ω—ñ–≤
# - –û—á–∏—â–µ–Ω–Ω—è system_logs > 30 –¥–Ω—ñ–≤
# - –û—á–∏—â–µ–Ω–Ω—è reminders > 5 –¥–Ω—ñ–≤
```

## üö® –ß–µ—Ä–≤–æ–Ω—ñ –ø—Ä–∞–ø–æ—Ä—Ü—ñ (Red Flags)

–Ø–∫—â–æ –±–∞—á–∏—Ç–µ:

1. **–¢—Ä–∞—Ñ—ñ–∫ > 1 –ì–ë/–¥–µ–Ω—å** –±–µ–∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
   ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç–∏ `diagnose_traffic.py`

2. **SQL –∑–∞–ø–∏—Ç–∏ –≤ –ª–æ–≥–∞—Ö** 
   ‚Üí LOG_LEVEL=DEBUG –≤–∫–ª—é—á–µ–Ω–∏–π!

3. **RAM 90-100%**
   ‚Üí –í–∏—Ç–æ–∫–∏ –ø–∞–º'—è—Ç—ñ, –∑–∞—Å—Ç—Ä—è–≥–ª—ñ –ø—Ä–æ—Ü–µ—Å–∏

4. **Broadcast status=in_progress** –±—ñ–ª—å—à–µ –≥–æ–¥–∏–Ω–∏
   ‚Üí –ó–∞—Å—Ç—Ä—è–≥–ª–∞ —Ä–æ–∑—Å–∏–ª–∫–∞

5. **Reminders –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ > 100**
   ‚Üí –ë–æ—Ç –Ω–µ –º–æ–∂–µ —ó—Ö –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏

## üìû –®–≤–∏–¥–∫–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

```bash
# –Ø–∫—â–æ —Ç—Ä–∞—Ñ—ñ–∫ –∑–Ω–æ–≤—É –≤–∏—Å–æ–∫–∏–π:
ssh root@173.242.49.209
cd /home/admin/upgrade-studio-bot

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞
python diagnose_traffic.py

# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
python fix_traffic.py

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart upgrade-bot upgrade-api upgrade-webhook

# –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
iftop
```

---

**–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è**: 15.01.2026  
**–°—Ç–∞—Ç—É—Å**: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≥–æ—Ç–æ–≤—ñ –¥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è  
**–ö—Ä–∏—Ç–∏—á–Ω—ñ—Å—Ç—å**: üî¥ –í–ò–°–û–ö–ê
